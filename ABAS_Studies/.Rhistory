geom_abline(intercept = 0, slope = 1, linetype="dashed") +
labs(x = "Reference Spinal Cord Volume (in cc)", y = "Drawn Spinal Cord Volume (in cc)") +
theme_bw() +
scale_colour_manual(values = paldef3)
#
y <- filter(mVolumesDistribution, organ=="cor" & Category %in% c("RSvsOR","MFvsOR","MF2vsOR"))
aggregate(y$VolDiff, by=list(y$Category), FUN=summary)
y <- filter(mVolumesDistribution, organ=="canalis" & Category %in% c("RSvsOR","MFvsOR","MF2vsOR"))
aggregate(y$VolDiff, by=list(y$Category), FUN=summary)
ggplot(filter(mVolumesDistribution, organ=="canalis" & Category %in% c("RSvsOR","MFvsOR","MF2vsOR") ),
aes(x=Category, y=VolDiff)) +
ylim(-300,200) +
geom_boxplot(aes(fill=Category)) +
theme_bw() +
labs(x = "Contouring comparison", y = "Spinal cord volume difference (in ccm)") +
scale_fill_manual(values = paldef2, guide=FALSE)
ggplot(filter(mVolumesDistribution, organ=="canalis" & Category %in% c("RSvsOR","MFvsOR","MF2vsOR") ),
aes(x=Category, y=VolDiff)) +
ylim(-40,40) +
geom_boxplot(aes(fill=Category)) +
theme_bw() +
labs(x = "Contouring comparison", y = "Spinal cord volume difference (in ccm)") +
scale_fill_manual(values = paldef2, guide=FALSE)
ggplot(filter(mVolumesDistribution, organ=="canalis" & Category %in% c("RSvsOR","MFvsOR","MF2vsOR") ),
aes(x=Category, y=VolDiff)) +
ylim(-50,50) +
geom_boxplot(aes(fill=Category)) +
theme_bw() +
labs(x = "Contouring comparison", y = "Spinal cord volume difference (in ccm)") +
scale_fill_manual(values = paldef2, guide=FALSE)
ggplot(filter(mVolumesDistribution, organ=="canalis" & Category %in% c("RSvsOR","MFvsOR","MF2vsOR") ),
aes(x=Category, y=VolDiff)) +
ylim(-50,50) +
geom_boxplot(aes(fill=Category)) +
theme_bw() +
labs(x = "Contouring comparison", y = "Spinal cord volume difference (in ccm)") +
scale_fill_manual(values = paldef3, guide=FALSE)
#
ggplot(filter(mVolumesDistribution, organ=="canalis" & Category %in% c("RSvsOR","MFvsOR","MF2vsOR") ),
aes(x=Category, y=VolDiff)) +
ylim(-50,50) +
geom_boxplot(aes(fill=Category)) +
theme_bw() +
labs(x = "Contouring comparison", y = "Spinal cord volume difference (in ccm)") +
scale_fill_manual(values = "grey80", "#4DAF4A", "#984EA3", guide=FALSE)
ggplot(filter(mVolumesDistribution, organ=="canalis" & Category %in% c("RSvsOR","MFvsOR","MF2vsOR") ),
aes(x=Category, y=VolDiff)) +
ylim(-50,50) +
geom_boxplot(aes(fill=Category)) +
theme_bw() +
labs(x = "Contouring comparison", y = "Spinal cord volume difference (in ccm)") +
scale_fill_manual(values = c("grey80", "#4DAF4A", "#984EA3"), guide=FALSE)
y <- filter(mVolumesDistribution, organ=="canalis" & Category %in% c("CKvsOR","SDvsOR","RSvsOR","MFvsOR","MF2vsOR"))
x <- filter(mVolumesDistribution, organ=="canalis" & Category %in% c("CKvsOR","SDvsOR","RSvsOR","MFvsOR","MF2vsOR"))
View(x)
View(y)
y <- filter(mVolumesDistribution, organ=="canalis" & Category %in% c("Rel.CK","Rel.SD","Rel.RS","Rel.MF","Rel.MF2"))
x <- filter(mVolumesDistribution, organ=="canalis" & Category %in% c("Dice.CK","Dice.SD","Dice.RS","Dice.MF","Dice.MF2"))
View(x)
all <- cbind(y,Dice=x$VolDiff)
View(all)
ggplot(all,aes(
y=100*VolDiff,
x=Dice,
shape=Category, colour=Category)) +
geom_point(size=3) +
scale_shape_manual(values=c(0,17,18)) +
geom_abline(intercept = 0, slope = 0.8, linetype="dashed") +
labs(y = "Change in MHD (Gy)", x = "Change in Heart V50Gy (pct difference)") +
theme_bw() +
scale_colour_manual(values = c("grey80", "#4DAF4A", "#984EA3"))
ggplot(all,aes(
y=VolDiff,
x=Dice,
shape=Category, colour=Category)) +
geom_point(size=3) +
scale_shape_manual(values=c(0,17,18)) +
geom_abline(intercept = 0, slope = 0.8, linetype="dashed") +
labs(y = "Volume overlap fraction", x = "Dice Similarity in spinal cord") +
theme_bw() +
scale_colour_manual(values = c("grey80", "#4DAF4A", "#984EA3"))
ggplot(all,aes(
y=VolDiff,
x=Dice,
shape=Category, colour=Category)) +
geom_point(size=3) +
scale_shape_manual(values=c(0,17,18)) +
geom_abline(intercept = 0, slope = 1, linetype="dashed") +
labs(y = "Volume overlap fraction", x = "Dice Similarity in spinal cord") +
theme_bw() +
scale_colour_manual(values = c("grey80", "#4DAF4A", "#984EA3"))
ggplot(all,aes(
y=VolDiff,
x=Dice,
shape=Category, colour=Category)) +
geom_point(size=3) +
scale_shape_manual(values=c(0,17,18)) +
geom_abline(intercept = -0.4, slope = 1.5, linetype="dashed") +
labs(y = "Volume overlap fraction", x = "Dice Similarity in spinal cord") +
theme_bw() +
scale_colour_manual(values = c("grey80", "#4DAF4A", "#984EA3"))
ggplot(all,aes(
y=VolDiff,
x=Dice,
shape=Category, colour=Category)) +
geom_point(size=3) +
scale_shape_manual(values=c(0,17,18)) +
geom_abline(intercept = -0.5, slope = 1.5, linetype="dashed") +
labs(y = "Volume overlap fraction", x = "Dice Similarity in spinal cord") +
theme_bw() +
scale_colour_manual(values = c("grey80", "#4DAF4A", "#984EA3"))
ggplot(all,aes(
y=VolDiff,
x=Dice,
shape=Category, colour=Category)) +
geom_point(size=3) +
scale_shape_manual(values=c(0,17,18)) +
geom_abline(intercept = -0.45, slope = 1.5, linetype="dashed") +
labs(y = "Volume overlap fraction", x = "Dice Similarity in spinal cord") +
theme_bw() +
scale_colour_manual(values = c("grey80", "#4DAF4A", "#984EA3"))
ggplot(all,aes(
y=VolDiff,
x=Dice,
shape=Category, colour=Category)) +
geom_point(size=3) +
scale_shape_manual(values=c(0,17,18)) +
xlim(0,1) + ylim(0,1) +
geom_abline(intercept = -0.45, slope = 1.5, linetype="dashed") +
labs(y = "Volume overlap fraction", x = "Dice Similarity in spinal cord") +
theme_bw() +
scale_colour_manual(values = c("grey80", "#4DAF4A", "#984EA3"))
ggplot(all,aes(
y=VolDiff,
x=Dice,
shape=Category, colour=Category)) +
geom_point(size=3) +
scale_shape_manual(values=c(0,17,18)) +
xlim(0.5,1) + ylim(0.5,1) +
geom_abline(intercept = -0.45, slope = 1.5, linetype="dashed") +
labs(y = "Volume overlap fraction", x = "Dice Similarity in spinal cord") +
theme_bw() +
scale_colour_manual(values = c("black", "#4DAF4A", "#984EA3"))
ggplot(all,aes(
y=VolDiff,
x=Dice,
shape=Category, colour=Category)) +
geom_point(size=3) +
scale_shape_manual(values=c(0,17,18)) +
xlim(0.5,1) + ylim(0.5,1) +
geom_abline(intercept = 0, slope = 1, linetype="dashed") +
labs(y = "Volume overlap fraction", x = "Dice Similarity in spinal cord") +
theme_bw() +
scale_colour_manual(values = c("black", "#4DAF4A", "#984EA3"))
volumesDistribution <- data.frame(
patid = volumes$patid,
organ = volumes$organ,
ref = volumes$OR,
ck = volumes$CK,
sd = volumes$SD,
rs = volumes$RS,
mf = volumes$MF,
mf2 = volumesNew$Mfnew,
CKvsOR = volumes$CK - volumes$OR,
SDvsOR = volumes$SD - volumes$OR,
RSvsOR = volumes$RS - volumes$OR,
MFvsOR = volumes$MF - volumes$OR,
MF2vsOR = volumesNew$Mfnew - volumes$OR,
Rel.CK = volumes$dCK / volumes$CK,
Dice.CK = (2*volumes$dCK)/(volumes$OR + volumes$CK),
Rel.SD = volumes$dSD / volumes$SD,
Dice.SD = (2*volumes$dSD)/(volumes$OR + volumes$SD),
Rel.RS = volumes$dRS / volumes$RS,
Dice.RS = (2*volumes$dRS)/(volumes$OR + volumes$RS),
Rel.MF = volumes$dMF / volumes$MF,
Dice.MF = (2*volumes$dMF)/(volumes$OR + volumes$MF),
Rel.MF2 = volumesNew$dMFnew / volumesNew$Mfnew,
Dice.MF2 = (2*volumesNew$dMFnew)/(volumes$OR + volumesNew$Mfnew)
)
mVolumesDistribution <- melt(volumesDistribution,id=c("patid","organ"))
names(mVolumesDistribution) <- c("patid","organ","Category","VolDiff")
mVolumesDistribution <- mVolumesDistribution[complete.cases(mVolumesDistribution),]
setwd("/Users/lenw/Documents/Clinical_Studies/Vejle_Projects/ABAS_Studies")
list.files(pattern = "\\.csv$")
#read csv file of raw values
rawdata <- read.csv("ck-sd-genanalyser2.csv", header=T)
rawdataNew <- read.csv("ck-sd-genanalyser3.csv", header=T)
#parse the volume subset
volumes <- filter(rawdata, type=="vol")
volumesNew <- filter(rawdataNew,type == "vol")
volumesDistribution <- data.frame(
patid = volumes$patid,
organ = volumes$organ,
ref = volumes$OR,
ck = volumes$CK,
sd = volumes$SD,
rs = volumes$RS,
mf = volumes$MF,
mf2 = volumesNew$Mfnew,
CKvsOR = volumes$CK - volumes$OR,
SDvsOR = volumes$SD - volumes$OR,
RSvsOR = volumes$RS - volumes$OR,
MFvsOR = volumes$MF - volumes$OR,
MF2vsOR = volumesNew$Mfnew - volumes$OR,
Rel.CK = volumes$dCK / volumes$CK,
Dice.CK = (2*volumes$dCK)/(volumes$OR + volumes$CK),
Rel.SD = volumes$dSD / volumes$SD,
Dice.SD = (2*volumes$dSD)/(volumes$OR + volumes$SD),
Rel.RS = volumes$dRS / volumes$RS,
Dice.RS = (2*volumes$dRS)/(volumes$OR + volumes$RS),
Rel.MF = volumes$dMF / volumes$MF,
Dice.MF = (2*volumes$dMF)/(volumes$OR + volumes$MF),
Rel.MF2 = volumesNew$dMFnew / volumesNew$Mfnew,
Dice.MF2 = (2*volumesNew$dMFnew)/(volumes$OR + volumesNew$Mfnew)
)
mVolumesDistribution <- melt(volumesDistribution,id=c("patid","organ"))
names(mVolumesDistribution) <- c("patid","organ","Category","VolDiff")
mVolumesDistribution <- mVolumesDistribution[complete.cases(mVolumesDistribution),]
dose <- filter(rawdata, type!="vol")
doseNew <- filter(rawdataNew, type!="vol")
doseDistribution <- data.frame(
patid = dose$patid,
organ = dose$organ,
type = dose$type,
ref = dose$OR,
ck = dose$CK,
sd = dose$SD,
rs = dose$RS,
mf = dose$MF,
mf2 = doseNew$Mfnew,
CKvsOR = as.numeric(as.character(dose$CK))-as.numeric(as.character(dose$OR)),
SDvsOR = as.numeric(as.character(dose$SD))-as.numeric(as.character(dose$OR)),
RSvsOR = as.numeric(as.character(dose$RS))-as.numeric(as.character(dose$OR)),
MFvsOR = as.numeric(as.character(dose$MF))-as.numeric(as.character(dose$OR)),
MF2vsOR = as.numeric(as.character(doseNew$Mfnew))-as.numeric(as.character(dose$OR))
)
mDoseDistribution <- melt(doseDistribution,id=c("patid","organ","type"))
names(mDoseDistribution) <- c("patid","organ","type","Category","DoseDiff")
mDoseDistribution <- mDoseDistribution[complete.cases(mDoseDistribution),]
#clean up
rm(dose,volumes,rawdata,doseNew,volumesNew,rawdataNew)
rm(doseDistribution,volumesDistribution)
y <- filter(mVolumesDistribution, organ=="canalis" & Category %in% c("Rel.CK","Rel.SD","Rel.RS","Rel.MF","Rel.MF2"))
x <- filter(mVolumesDistribution, organ=="canalis" & Category %in% c("Dice.CK","Dice.SD","Dice.RS","Dice.MF","Dice.MF2"))
all <- cbind(y,Dice=x$VolDiff)
ggplot(all,aes(
y=VolDiff,
x=Dice,
shape=Category, colour=Category)) +
geom_point(size=3) +
scale_shape_manual(values=c(0,17,18)) +
xlim(0.5,1) + ylim(0.5,1) +
geom_abline(intercept = 0, slope = 1, linetype="dashed") +
labs(y = "Volume overlap fraction", x = "Dice Similarity in spinal cord") +
theme_bw() +
scale_colour_manual(values = c("black", "#4DAF4A", "#984EA3"))
y <- filter(mDoseDistribution, organ=="canalis" & type=="d1cc" & Category %in% c("CKvsOR","SDvsOR","RSvsOR","MFvsOR","MF2vsOR"))
aggregate(100*y$DoseDiff, by=list(y$Category), FUN=summary)
aggregate(y$DoseDiff, by=list(y$Category), FUN=summary)
View(y)
ggplot(filter(mDoseDistribution, organ=="canalis" & Category %in% c("RSvsOR","MFvsOR","MF2vsOR") ),
aes(x=Category, y=DoseDiff)) +
ylim(-50,50) +
geom_boxplot(aes(fill=Category)) +
theme_bw() +
labs(x = "Contouring comparison", y = "Change in D1cc High Dose (Gy)") +
scale_fill_manual(values = c("grey80", "#4DAF4A", "#984EA3"), guide=FALSE)
ggplot(filter(mDoseDistribution, organ=="canalis" & Category %in% c("RSvsOR","MFvsOR","MF2vsOR") ),
aes(x=Category, y=DoseDiff)) +
ylim(-5,20) +
geom_boxplot(aes(fill=Category)) +
theme_bw() +
labs(x = "Contouring comparison", y = "Change in D1cc High Dose (Gy)") +
scale_fill_manual(values = c("grey80", "#4DAF4A", "#984EA3"), guide=FALSE)
ggplot(filter(mDoseDistribution, organ=="canalis" & Category %in% c("RSvsOR","MFvsOR","MF2vsOR") ),
aes(x=Category, y=DoseDiff)) +
ylim(-5,12) +
geom_boxplot(aes(fill=Category)) +
theme_bw() +
labs(x = "Contouring comparison", y = "Change in D1cc High Dose (Gy)") +
scale_fill_manual(values = c("grey80", "#4DAF4A", "#984EA3"), guide=FALSE)
#this needs to be edited to set the folder that contains the files
setwd("/Users/lenw/Documents/Clinical_Studies/Vejle_Projects/ABAS_Studies")
list.files(pattern = "\\.csv$")
#read csv file of raw values
rawdata <- read.csv("ck-sd-genanalyser2.csv", header=T)
rawdataNew <- read.csv("ck-sd-genanalyser3.csv", header=T)
#parse the volume subset
volumes <- filter(rawdata, type=="vol")
volumesNew <- filter(rawdataNew,type == "vol")
volumesDistribution <- data.frame(
patid = volumes$patid,
organ = volumes$organ,
ref = volumes$OR,
ck = volumes$CK,
sd = volumes$SD,
rs = volumes$RS,
mf = volumes$MF,
mf2 = volumesNew$Mfnew,
CKvsOR = volumes$CK - volumes$OR,
SDvsOR = volumes$SD - volumes$OR,
RSvsOR = volumes$RS - volumes$OR,
MFvsOR = volumes$MF - volumes$OR,
MF2vsOR = volumesNew$Mfnew - volumes$OR,
Rel.CK = volumes$dCK / volumes$CK,
Dice.CK = (2*volumes$dCK)/(volumes$OR + volumes$CK),
Rel.SD = volumes$dSD / volumes$SD,
Dice.SD = (2*volumes$dSD)/(volumes$OR + volumes$SD),
Rel.RS = volumes$dRS / volumes$RS,
Dice.RS = (2*volumes$dRS)/(volumes$OR + volumes$RS),
Rel.MF = volumes$dMF / volumes$MF,
Dice.MF = (2*volumes$dMF)/(volumes$OR + volumes$MF),
Rel.MF2 = volumesNew$dMFnew / volumesNew$Mfnew,
Dice.MF2 = (2*volumesNew$dMFnew)/(volumes$OR + volumesNew$Mfnew)
)
mVolumesDistribution <- melt(volumesDistribution,id=c("patid","organ"))
names(mVolumesDistribution) <- c("patid","organ","Category","VolDiff")
mVolumesDistribution <- mVolumesDistribution[complete.cases(mVolumesDistribution),]
#parse the dosimetry subset
dose <- filter(rawdata, type!="vol")
doseNew <- filter(rawdataNew, type!="vol")
doseDistribution <- data.frame(
patid = dose$patid,
organ = dose$organ,
type = dose$type,
ref = dose$OR,
ck = dose$CK,
sd = dose$SD,
rs = dose$RS,
mf = dose$MF,
mf2 = doseNew$Mfnew,
CKvsOR = as.numeric(as.character(dose$CK))-as.numeric(as.character(dose$OR)),
SDvsOR = as.numeric(as.character(dose$SD))-as.numeric(as.character(dose$OR)),
RSvsOR = as.numeric(as.character(dose$RS))-as.numeric(as.character(dose$OR)),
MFvsOR = as.numeric(as.character(dose$MF))-as.numeric(as.character(dose$OR)),
MF2vsOR = as.numeric(as.character(doseNew$Mfnew))-as.numeric(as.character(dose$OR))
)
mDoseDistribution <- melt(doseDistribution,id=c("patid","organ","type"))
names(mDoseDistribution) <- c("patid","organ","type","Category","DoseDiff")
mDoseDistribution <- mDoseDistribution[complete.cases(mDoseDistribution),]
#clean up
rm(dose,volumes,rawdata,doseNew,volumesNew,rawdataNew)
rm(doseDistribution,volumesDistribution)
#colour palette definition
paldef0 <- c("#E41A1C", "#377EB8", "#4DAF4A", "#984EA3")
paldef <- c("#E41A1C", "#377EB8", "black", "#4DAF4A", "#984EA3")
paldef2 <- c("#E41A1C", "#377EB8", "grey80", "#4DAF4A", "#984EA3")
paldef3 <- c("black", "#4DAF4A", "#984EA3")
ppi <- 600
# Calculate the height and width (in pixels) for a 4x4-inch image at 600 ppi
png("ABAS-Lung-in_Raystation-%d.png", width=6*ppi, height=4*ppi, res=ppi)
#absolute lung volume correlation plot
y <- filter(mVolumesDistribution, organ=="pulm" & Category %in% c("ck","sd","rs","mf","mf2"))
x <- filter(mVolumesDistribution, organ=="pulm" & Category %in% c("ref"))
all <- cbind(y,Baseline=x$VolDiff)
ggplot(all,aes(
x=Baseline,
y=VolDiff,
shape=Category, colour=Category)) +
geom_point(size=3) +
scale_shape_manual(values=c(15,16,0,17,18)) +
xlim(1900,5500) + ylim(1900,5500) +
geom_abline(intercept = 0, slope = 1, linetype="dashed") +
labs(x = "Reference Lung Volume (in cc)", y = "Drawn Lung Volume (in cc)") +
theme_bw() +
scale_colour_manual(values = paldef)
#summarise the median and distribution of the absolute volume differences
y <- filter(mVolumesDistribution, organ=="pulm" & Category %in% c("CKvsOR","SDvsOR","RSvsOR","MFvsOR","MF2vsOR"))
aggregate(y$VolDiff, by=list(y$Category), FUN=summary)
#summary information graphically
ggplot(filter(mVolumesDistribution, organ=="pulm" & Category %in% c("CKvsOR","SDvsOR","RSvsOR","MFvsOR","MF2vsOR") ),
aes(x=Category, y=VolDiff)) +
ylim(-200,800) +
geom_boxplot(aes(fill=Category)) +
theme_bw() +
labs(x = "Contouring comparison", y = "Lung volume difference (in ccm)") +
scale_fill_manual(values = paldef2, guide=FALSE)
#correlations in lung doses differences
y <- filter(mDoseDistribution, type=="v20" & organ=="pulm" & Category %in% c("CKvsOR","SDvsOR","RSvsOR","MFvsOR","MF2vsOR"))
x <- filter(mDoseDistribution, type=="avdose" & organ=="pulm" & Category %in% c("CKvsOR","SDvsOR","RSvsOR","MFvsOR","MF2vsOR"))
all <- cbind(y,MLD=x$DoseDiff)
ggplot(all,aes(
y=MLD,
x=100*DoseDiff,
shape=Category, colour=Category)) +
geom_point(size=3) +
scale_shape_manual(values=c(15,16,0,17,18)) +
geom_abline(intercept = 0, slope = 0.5, linetype="dashed") +
labs(y = "Change in MLD (Gy)", x = "Change in Lung V20Gy (pct difference)") +
theme_bw() +
scale_colour_manual(values = paldef)
#summarise the median and distribution of the V20 volume differences
y <- filter(mDoseDistribution, organ=="pulm" & type=="v20" & Category %in% c("CKvsOR","SDvsOR","RSvsOR","MFvsOR","MF2vsOR"))
aggregate(100*y$DoseDiff, by=list(y$Category), FUN=summary)
#summarise the median and distribution of the mean lung dose differences
y <- filter(mDoseDistribution, organ=="pulm" & type=="avdose" & Category %in% c("CKvsOR","SDvsOR","RSvsOR","MFvsOR","MF2vsOR"))
aggregate(y$DoseDiff, by=list(y$Category), FUN=summary)
#dice similarity comparison
ggplot(filter(mVolumesDistribution, organ=="pulm" & Category %in% c("Dice.CK","Dice.SD","Dice.RS","Dice.MF","Dice.MF2") ),
aes(x=Category, y=VolDiff)) +
geom_boxplot(aes(fill=Category)) +
theme_bw() +
labs(x = "Contouring comparison", y = "Dice Similarity in Lung (a.u.)") +
scale_fill_manual(values = paldef2, guide=FALSE)
y <- filter(mVolumesDistribution, organ=="pulm" & Category %in% c("Dice.CK","Dice.SD","Dice.RS","Dice.MF","Dice.MF2"))
aggregate(y$VolDiff, by=list(y$Category), FUN=summary)
dev.off()
ppi <- 600
# Calculate the height and width (in pixels) for a 4x4-inch image at 600 ppi
png("ABAS-Heart-in_Raystation-%d.png", width=6*ppi, height=4*ppi, res=ppi)
#absolute heart volume correlation plot
y <- filter(mVolumesDistribution, organ=="cor" & Category %in% c("ck","sd","rs","mf","mf2"))
x <- filter(mVolumesDistribution, organ=="cor" & Category %in% c("ref"))
all <- cbind(y,Baseline=x$VolDiff)
ggplot(all,aes(
x=Baseline,
y=VolDiff,
shape=Category, colour=Category)) +
geom_point(size=3) +
xlim(400,1600) + ylim(400,1600) +
scale_shape_manual(values=c(15,16,0,17,18)) +
geom_abline(intercept = 0, slope = 1, linetype="dashed") +
labs(x = "Reference Heart Volume (in cc)", y = "Drawn Heart Volume (in cc)") +
theme_bw() +
scale_colour_manual(values = paldef)
#summarise the median and distribution of the absolute volume differences
y <- filter(mVolumesDistribution, organ=="cor" & Category %in% c("CKvsOR","SDvsOR","RSvsOR","MFvsOR","MF2vsOR"))
aggregate(y$VolDiff, by=list(y$Category), FUN=summary)
#summary information graphically
ggplot(filter(mVolumesDistribution, organ=="cor" & Category %in% c("CKvsOR","SDvsOR","RSvsOR","MFvsOR","MF2vsOR") ),
aes(x=Category, y=VolDiff)) +
ylim(-300,200) +
geom_boxplot(aes(fill=Category)) +
theme_bw() +
labs(x = "Contouring comparison", y = "Heart volume difference (in ccm)") +
scale_fill_manual(values = paldef2, guide=FALSE)
#correlations in heart doses differences
y <- filter(mDoseDistribution, type=="v50" & organ=="cor" & Category %in% c("CKvsOR","SDvsOR","RSvsOR","MFvsOR","MF2vsOR"))
x <- filter(mDoseDistribution, type=="avdose" & organ=="cor" & Category %in% c("CKvsOR","SDvsOR","RSvsOR","MFvsOR","MF2vsOR"))
all <- cbind(y,MHD=x$DoseDiff)
ggplot(all,aes(
y=MHD,
x=100*DoseDiff,
shape=Category, colour=Category)) +
geom_point(size=3) +
scale_shape_manual(values=c(15,16,0,17,18)) +
geom_abline(intercept = 0, slope = 0.8, linetype="dashed") +
labs(y = "Change in MHD (Gy)", x = "Change in Heart V50Gy (pct difference)") +
theme_bw() +
scale_colour_manual(values = paldef)
#summarise the median and distribution of the V50 volume differences
y <- filter(mDoseDistribution, organ=="cor" & type=="v50" & Category %in% c("CKvsOR","SDvsOR","RSvsOR","MFvsOR","MF2vsOR"))
aggregate(100*y$DoseDiff, by=list(y$Category), FUN=summary)
#summarise the median and distribution of the mean heart dose differences
y <- filter(mDoseDistribution, organ=="cor" & type=="avdose" & Category %in% c("CKvsOR","SDvsOR","RSvsOR","MFvsOR","MF2vsOR"))
aggregate(y$DoseDiff, by=list(y$Category), FUN=summary)
#dice similarity comparison
ggplot(filter(mVolumesDistribution, organ=="cor" & Category %in% c("Dice.CK","Dice.SD","Dice.RS","Dice.MF","Dice.MF2") ),
aes(x=Category, y=VolDiff)) +
geom_boxplot(aes(fill=Category)) +
theme_bw() +
labs(x = "Contouring comparison", y = "Dice Similarity in Heart (a.u.)") +
scale_fill_manual(values = paldef2, guide=FALSE)
y <- filter(mVolumesDistribution, organ=="cor" & Category %in% c("Dice.CK","Dice.SD","Dice.RS","Dice.MF","Dice.MF2"))
aggregate(y$VolDiff, by=list(y$Category), FUN=summary)
dev.off()
ppi <- 600
# Calculate the height and width (in pixels) for a 4x4-inch image at 600 ppi
png("ABAS-SpinalCord-in_Raystation-%d.png", width=6*ppi, height=4*ppi, res=ppi)
#absolute spinal cord volume correlation plot
#
#note that here - it is not the volume agreement that matters but
#rather the dice similarity and overlap volume
#
#summarise the median and distribution of the absolute volume differences
y <- filter(mVolumesDistribution, organ=="canalis" & Category %in% c("RSvsOR","MFvsOR","MF2vsOR"))
aggregate(y$VolDiff, by=list(y$Category), FUN=summary)
#summary information graphically
ggplot(filter(mVolumesDistribution, organ=="canalis" & Category %in% c("RSvsOR","MFvsOR","MF2vsOR") ),
aes(x=Category, y=VolDiff)) +
ylim(-50,50) +
geom_boxplot(aes(fill=Category)) +
theme_bw() +
labs(x = "Contouring comparison", y = "Spinal cord volume difference (in ccm)") +
scale_fill_manual(values = c("grey80", "#4DAF4A", "#984EA3"), guide=FALSE)
#similarity and overlap
y <- filter(mVolumesDistribution, organ=="canalis" & Category %in% c("Rel.CK","Rel.SD","Rel.RS","Rel.MF","Rel.MF2"))
x <- filter(mVolumesDistribution, organ=="canalis" & Category %in% c("Dice.CK","Dice.SD","Dice.RS","Dice.MF","Dice.MF2"))
all <- cbind(y,Dice=x$VolDiff)
ggplot(all,aes(
y=VolDiff,
x=Dice,
shape=Category, colour=Category)) +
geom_point(size=3) +
scale_shape_manual(values=c(0,17,18)) +
xlim(0.5,1) + ylim(0.5,1) +
geom_abline(intercept = 0, slope = 1, linetype="dashed") +
labs(y = "Volume overlap fraction", x = "Dice Similarity in spinal cord") +
theme_bw() +
scale_colour_manual(values = c("black", "#4DAF4A", "#984EA3"))
#summarise the median and distribution of the high dose differences (d1cc)
y <- filter(mDoseDistribution, organ=="canalis" & type=="d1cc" & Category %in% c("CKvsOR","SDvsOR","RSvsOR","MFvsOR","MF2vsOR"))
aggregate(y$DoseDiff, by=list(y$Category), FUN=summary)
#summary information graphically
ggplot(filter(mDoseDistribution, organ=="canalis" & Category %in% c("RSvsOR","MFvsOR","MF2vsOR") ),
aes(x=Category, y=DoseDiff)) +
ylim(-5,12) +
geom_boxplot(aes(fill=Category)) +
theme_bw() +
labs(x = "Contouring comparison", y = "Change in D1cc High Dose (Gy)") +
scale_fill_manual(values = c("grey80", "#4DAF4A", "#984EA3"), guide=FALSE)
dev.off()
